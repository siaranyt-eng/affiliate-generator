<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Affiliate Content Generator</title>
  <style>
    :root{--bg:#0b1622;--card:#15283d;--text:#e6efff;--accent:#7b4eff;--muted:#90a4c3;}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg)}
    header{padding:18px 20px;background:#122438;display:flex;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:20px;letter-spacing:.4px}
    .container{max-width:1100px;margin:20px auto;padding:0 16px;display:grid;grid-template-columns:360px 1fr;gap:16px}
    .card{background:var(--card);border:1px solid #27435f;border-radius:14px;padding:14px}
    textarea,select,input{width:100%;padding:10px;border-radius:10px;border:1px solid #27435f;background:#0f1e2f;color:var(--text)}
    button{background:var(--accent);border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
    button.ghost{background:#1a2b41;border:1px solid #2c4a6e}
    .output{white-space:pre-wrap;background:#0d1c2b;border-radius:10px;padding:12px;border:1px solid #27435f;min-height:240px}
    /* API badge + modal */
    .api-badge{display:flex;gap:8px;align-items:center}
    .dot{width:10px;height:10px;border-radius:50%;background:#e74c3c}
    .dot.ok{background:#2ecc71}
    .api-btn{padding:8px 12px;border:1px solid #2e415b;border-radius:10px;background:#101b2a;color:#fff;cursor:pointer}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
    .card-modal{background:#1b2a3e;border:1px solid #2e415b;border-radius:14px;padding:16px;width:min(92vw,460px)}
    .row{display:flex;gap:8px;margin-top:10px}
    .row input{flex:1}
    .hint{color:var(--muted);font-size:12px}
    .mt{margin-top:10px}
  </style>
</head>
<body>

  <header>
    <h1>AFFILIATE Content Generator</h1>
    <div class="api-badge">
      <span id="apiDot" class="dot"></span>
      <button class="api-btn" onclick="openApiModal()">Atur API Key</button>
    </div>
  </header>

  <main class="container">
    <!-- kiri: form -->
    <section class="card">
      <h3 style="margin:0 0 10px">Input Produk</h3>
      <label>Deskripsi Produk</label>
      <textarea id="desc" rows="6" placeholder="Contoh: Kaos pria distro katun 24s tebal, warna hitam-biru, streetwear."></textarea>
      <div class="mt"></div>
      <button onclick="onGenerateClick()">Generate Konten</button>
    </section>

    <!-- kanan: hasil -->
    <section class="card">
      <h3 style="margin:0 0 10px">Hasil Generate</h3>
      <div id="output" class="output">Hasil akan muncul di sini…</div>
    </section>
  </main>

  <!-- Modal API Key -->
  <div id="apiModal" class="modal" onclick="if(event.target.id==='apiModal') closeApiModal()">
    <div class="card-modal">
      <h3 style="margin:0 0 6px">Set Gemini API Key</h3>
      <div class="hint">Kunci disimpan di <b>browser kamu</b> (localStorage) lalu dikirim ke server via header <code>x-user-gemini-key</code>. Hapus jika ingin pakai key server.</div>
      <div class="row mt">
        <input id="apiInput" type="password" placeholder="AIxx... (paste di sini)"/>
        <button onclick="saveApiKey()">Simpan</button>
        <button class="ghost" onclick="clearApiKey()">Hapus</button>
      </div>
    </div>
  </div>

  <script>
    // ====== API KEY UI ======
    const API_KEY_STORAGE = "gemini_api_key";
    function openApiModal(){ document.getElementById('apiModal').style.display='flex';
      document.getElementById('apiInput').value = localStorage.getItem(API_KEY_STORAGE)||""; }
    function closeApiModal(){ document.getElementById('apiModal').style.display='none'; }
    function updateApiDot(){ const ok = !!localStorage.getItem(API_KEY_STORAGE);
      const dot = document.getElementById('apiDot'); dot.classList.toggle('ok', ok); }
    function saveApiKey(){ const v=(document.getElementById('apiInput').value||"").trim();
      if(!v) return alert("Isi API key dulu ya"); localStorage.setItem(API_KEY_STORAGE, v); updateApiDot(); closeApiModal(); }
    function clearApiKey(){ localStorage.removeItem(API_KEY_STORAGE); updateApiDot(); closeApiModal(); }
    updateApiDot();

    // ====== helper fetch POST JSON (auto tambah header x-user-gemini-key) ======
    async function postJSON(url, body){
      const key = localStorage.getItem(API_KEY_STORAGE) || "";
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json", "x-user-gemini-key": key },
        body: JSON.stringify(body||{})
      });
      try { return await res.json(); } catch { return { status:"error", raw: await res.text() }; }
    }

    // ====== tombol generate ======
    async function onGenerateClick(){
      const desc = document.getElementById("desc").value.trim();
      const out = document.getElementById("output");
      if(!desc){ alert("Tolong isi deskripsi produk dulu."); return; }
      out.textContent = "⏳ memproses…";

      const [ugc, broll, ads] = await Promise.all([
        postJSON("/api/generate/ugc",   { desc }),
        postJSON("/api/generate/broll", { desc }),
        postJSON("/api/generate/ads",   { desc }),
      ]);

      out.textContent = JSON.stringify({ ugc, broll, ads }, null, 2);
    }
  </script>
</body>
</html>
